"use strict";var version="0.4.4",abLoopPlugin=function(t){var e=this,n=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},o=function(t){var e={};return t&&"[object Function]"===e.toString.call(t)},r=function(t){return!!t},a=function(t,e){var n={};return e.forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n},i=function(t,e){return e=e||1,videojs.formatTime(t)+"."+Math.floor(t%1*Math.pow(10,e))},u=function(t,e){var n=Math.pow(10,e);return Math.floor(t*n)/n},f=function(t){if(void 0===t)return void 0;if(n(t))return t;if(/^([+\-])?([\d\.]+)$/i.test(t))return parseFloat(t);var e=/^([+\-])?((([\d]+)(h|:(?=.*:)))?(([\d]+)(m|:|$))?)?(([\d\.]+)s?)?$/i.exec(t);if(!e)return null;var o={match:e[0],sign:e[1],hours:e[4]||0,mins:e[7]||0,secs:e[10]||0},r="-"==o.sign?-1:1,a=60*parseFloat(o.hours)*60+60*parseFloat(o.mins)+parseFloat(o.secs);return n(a)?r*a:null},c={},s={start:{"default":0,validate:function(t){return t===!1?t:n(t)&&t>=0?t:0}},end:{"default":!1,validate:function(t){if(t===!1)return t;if(n(t)){var o=e.duration();if(void 0===o||0===o){if(t>=0)return t}else{if(t>=0&&o>=t)return t;if(t>o)return o}}return!1}},enabled:{"default":!1,validate:r},loopIfBeforeStart:{"default":!0,validate:r},loopIfAfterEnd:{"default":!0,validate:r},pauseBeforeLooping:{"default":!1,validate:r},pauseAfterLooping:{"default":!1,validate:r}},l={onLoopCallBack:{"default":void 0,check:o},onOptionsChange:{"default":void 0,check:o}},p=Object.keys(s),d=Object.keys(l),g=function(){t=t||{};var e=function(e){return function(n){void 0===t[n]&&(t[n]=e[n].default)}};p.forEach(e(s)),d.forEach(e(l))},v=function(){d.forEach(function(e){l[e].check(t[e])&&(Z[e]=t[e])})},h=function(){return p.forEach(function(t){c[t]=s[t].validate(c[t])}),Z},L=function(){return m(t,!0)},m=function(t,e){return p.forEach(function(n){(e||void 0!==t[n])&&(c[n]=t[n])}),h(),Z},b=!1,y=function(t){return t?c.pauseBeforeLooping&&b===!1?(e.pause(),b=!0):(b=!1,e.currentTime(c.start),c.pauseAfterLooping&&e.pause(),l.onLoopCallBack.check(Z.onLoopCallBack)&&Z.onLoopCallBack(Z,e)):(b=!1,e.currentTime(c.start)),Z},E=function(){return b=!1,e.currentTime(c.end),Z},A=function(t){return function(n){return n===!1?c[t]=!1:(void 0!==n&&(n=f(n)),null!==n&&(n=void 0===n?e.currentTime():n,c[t]=n)),Z}},B=function(t){return function(e){return e=f(e),n(e)&&(c[t]+=e),Z}},O=function(){return h(),y(!1),P(),e.play(),Z},P=function(){return c.enabled=!0,Z},k=function(){return c.enabled=!1,Z},w=function(){var t=c.pauseAfterLooping,e=c.pauseBeforeLooping;return m(t||e?t&&!e?{pauseAfterLooping:!1,pauseBeforeLooping:!0}:!t&&e?{pauseAfterLooping:!0,pauseBeforeLooping:!0}:{pauseAfterLooping:!1,pauseBeforeLooping:!1}:{pauseAfterLooping:!0,pauseBeforeLooping:!1}),Z},T=function(t){return function(){return c[t]=!c[t],Z}},U=function(t){if(!t.match(/^https?:\/\//)&&window&&window.document){var e=window.document.createElement("div");e.innerHTML='<a href="'+t+'">x</a>',t=e.firstChild.href}return t},S=function(t){return U(x(t))},F=function(t){t=t||{},t.decimalPlaces=Math.floor(t.decimalPlaces)||3;var e=c.start!==!1?parseFloat(c.start):0,n="#t="+u(e,t.decimalPlaces);if(c.end!==!1){var o=parseFloat(c.end);n+=","+u(o,t.decimalPlaces)}return n},x=function(t){t=t||{};var n=e.currentSrc();n.src&&(n=n.src);var o=n+F(t);return o},j=function(t){if("string"==typeof t&&(t=videojs.parseUrl(t)),t.hash){var e=/^(#?t=)?([^,]*)(,(.*))?$/,o=t.hash.replace(e,"$2"),r=t.hash.replace(e,"$4");o=f(o),r=f(r),n(o)&&(c.start=parseFloat(o)),n(r)&&(c.end=parseFloat(r))}return Z},C=function(t){var n=t.replace(/^(.*?)(#.*)?$/,"$1"),o=t.replace(/^(.*?)(#.*)?$/,"$2"),r=e.currentSrc();return r!=n&&r!=t&&t!=o&&e.src(n),o&&j(o),Z},$=function(t){var e=t;return"string"==typeof t?e=[t]:void 0!==t&&Array.isArray(t)||(e=Object.keys(null!==t&&"object"==typeof t?t:s)),a(c,e)},K=function(t,n){var o=n?!1:!0;return n=n||{},p.forEach(function(t){n[t]=!!n[t]||o}),function(){var o=arguments,r=$(),a=t.apply(null,o),i={changed:n,oldOpts:r,newOpts:$()};return Z.onOptionsChange&&Z.onOptionsChange(i,Z,e),Y(n),a}},I=!1,M=.5,N=1,D=function(){var t,n,o;if(h(),t=e.currentTime(),n=q(),o=R(),o>n){if(I=!0,o-M>t&&t>n&&(N>t-n||c.loopIfAfterEnd||c.loopIfBeforeStart))return!0}else{if(I=!1,o-M>t&&c.loopIfBeforeStart)return!0;if(t>=n&&(N>t-n||c.loopIfAfterEnd))return!0}return!1},R=function(){return c.start===!1?0:c.start},q=function(){return c.end===!1?e.duration():c.end},H=!1,V=n(t.minLoopLength)&&t.minLoopLength>0?t.minLoopLength:200,z=function(){!H&&c.enabled&&!e.paused()&&D()&&(H=!0,setTimeout(function(){H=!1},V),y(!0))},G={},J=[{name:"start",optionsUsed:["start"],leftclick:function(t,e){e.shiftKey?t.adjustStart(-.5):t.setStart()},rightclick:function(t,e){e.shiftKey?t.adjustStart(.5):t.goToStart()},defaultText:"Start",textFunction:function(t){return i(t.start)}},{name:"end",optionsUsed:["end"],leftclick:function(t,e){e.shiftKey?t.adjustEnd(-.5):e.ctrlKey?t.adjustEnd(-.05):t.setEnd()},rightclick:function(t,e){e.shiftKey?t.adjustEnd(.5):e.ctrlKey?t.adjustEnd(.05):t.goToEnd()},defaultText:"End",textFunction:function(t){return i(t.end)}},{name:"enabled",optionsUsed:["enabled","pauseAfterLooping","pauseBeforeLooping"],leftclick:function(t){t.toggle()},rightclick:function(t,e){var n;window&&window.prompt&&(e.ctrlKey?n=t.getAbsoluteUrl():e.altKey?n=t.getUrl():e.shiftKey&&(n=t.getUrlFragment())),n?Q(n):t.cyclePauseOnLooping()},defaultText:"Loop",textFunction:function(t){return t.enabled?t.pauseBeforeLooping&&t.pauseAfterLooping?"PAUSE LOOP PAUSE":t.pauseAfterLooping?"LOOP& PAUSE":t.pauseBeforeLooping?"PAUSE &LOOP":"LOOP ON":"Loop off"}}],Q=function(t){window&&window.prompt&&window.prompt("Copy to clipboard: Ctrl+C, Enter",t)},W=function(t,e){var n=function(t,n){return function(o){(void 0===n||o.which&&o.which==n)&&(t(e.abLoopPlugin,o),this.updateText())}},o=function(t,e){return function(){var n=e(c)||t,o=this.el();o.textContent=n}},r=e.controlBar.addChild("Button");return t.leftclick&&r.on("click",n(t.leftclick)),t.rightclick&&(r.el().onmousedown=n(t.rightclick,3).bind(r),r.on("contextmenu",function(t){return t.preventDefault&&t.preventDefault(),t.preventDefault&&t.stopPropagation(),!1})),r.updateText=o(t.defaultText,t.textFunction),r.optionsUsed=t.optionsUsed,r.addClass("abLoopButton"),r.addClass(t.name),r.updateText(),r},X=function(t){t.forEach(function(t){void 0===G[t.name]&&(G[t.name]=W(t,e))})},Y=function(t){var e=function(e,n){return e||t[n]};for(var n in G){var o=G[n],r=!o.optionsUsed||o.optionsUsed.reduce(e,!1);r&&o.updateText()}},Z={validateOptions:K(h),resetToInitialOptions:K(L),setOptions:K(m),getOptions:$,goToStart:y,goToEnd:E,setStart:K(A("start"),{start:!0}),setEnd:K(A("end"),{end:!0}),adjustStart:K(B("start"),{start:!0}),adjustEnd:K(B("end"),{end:!0}),enable:K(P,{enabled:!0}),disable:K(k,{enabled:!0}),toggle:K(T("enabled"),{enabled:!0}),togglePauseAfterLooping:K(T("pauseAfterLooping"),{pauseAfterLooping:!0}),togglePauseBeforeLooping:K(T("pauseBeforeLooping"),{pauseBeforeLooping:!0}),cyclePauseOnLooping:K(w,{pauseBeforeLooping:!0,pauseAfterLooping:!0}),player:e,version:version,getAbsoluteUrl:S,getUrl:x,getUrlFragment:F,applyUrl:K(C,{start:!0,end:!0}),applyUrlFragment:K(j,{start:!0,end:!0}),loopRequired:D,playLoop:K(O)},_=function(){g(),v(),K(L)(),e.ready(function(){0!=t.createButtons&&X(J),e.on("ended",function(){I&&c.enabled&&!e.loop()&&e.play()})}),e.abLoopPlugin=Z,e.on("timeupdate",z),Z.loaded=!0};return _(),Z};abLoopPlugin.loaded=!1,abLoopPlugin.VERSION=version,module.exports=abLoopPlugin;